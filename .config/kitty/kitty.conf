# Generall settings - don't touch it
font_family      MesloLGM Nerd Font
bold_font        auto
italic_font      auto
bold_italic_font auto
font_size 15
background_opacity 0.80
#linux_display_server x11
linux_display_server wayland
update_check_interval 0
wayland_titlebar_color background
startup_session none
enabled_layouts tall,grid,splits,stack
confirm_os_window_close 0
shell_integration enabled
allow_cloning yes
listen_on unix:@mykitty
# if @mykitty wouldn't work try:
#listen_on unix:/tmp/kitty
allow_remote_control yes

# Tab Bar
tab_bar_edge top
tab_bar_style powerline
tab_fade 0 1 1 1
active_tab_font_style   bold-italic
inactive_tab_font_style normal

# Scrollback keys
map ctrl+q scroll_line_down
map alt+q scroll_line_up
map alt+< scroll_home
map alt+> scroll_end
map ctrl+v scroll_page_down
map alt+v scroll_page_up

# TODO - Scrollback
#scrollback_pager /usr/bin/nvim -c "set nonumber nolist showtabline=0 foldcolumn=0" -c "autocmd TermOpen * normal G" -c "silent write /tmp/kitty_scrollback_buffer | te cat /tmp/kitty_scrollback_buffer - "
scrollback_lines 10000
# Cursor
cursor_blink_interval 0

# Browse output of the last shell command in pager
map ctrl+shift+` launch sh -c "rm /tmp/kitty_scrollback_buffer"    # remove annoying buffer which messes up terminal output
map ctrl+shift+g show_last_command_output
#map ctrl+shift+g show_last_visited_command_output
#map ctrl+shift+g show_first_command_output_on_screen

# Paste the output of the last command
map ctrl+shift+alt+g combine : launch --stdin-source=@last_cmd_output --type=primary : paste_from_selection

# pipe the contents of the scrollback buffer to an arbitrary, command running in a new window, tab or overlay
#map ctrl+shift+b launch --stdin-source=@screen_scrollback --stdin-add-formatting --type=overlay less +G -R

# pipe the contents of the scrollback buffer to nvim
#map ctrl+shift+m show_scrollback

# Paste from clipboard
map ctrl+y paste_from_clipboard

# Window management
map ctrl+k next_window
map ctrl+j previous_window
map ctrl+shift+k move_window_forward
map ctrl+shift+j move_window_backward

map alt+shift+s new_window
map alt+s new_window_with_cwd
map alt+c close_window
map alt+r start_resizing_window
map alt+m toggle_layout stack

# Tab management
map alt+shift+n next_tab
map alt+shift+p previous_tab
#map ctrl+shift+t new_tab !neighbor
map alt+t launch --cwd=current --type=tab
map alt+shift+t set_tab_title
#map alt+shift+u close_tab      # I close all windows first
map alt+shift+f move_tab_forward
map alt+shift+b move_tab_backward
map alt+1 goto_tab 1
map alt+2 goto_tab 2
map alt+3 goto_tab 3
map alt+4 goto_tab 4
map alt+5 goto_tab 5

# Layout management
map ctrl+shift+] next_layout
map ctrl+shift+[ last_used_layout

# Select and act on visible text
map ctrl+shift+y kitten hints --type path --program -
map ctrl+shift+p>f kitten hints --type path
map ctrl+shift+p>l kitten hints --type line --program -
map ctrl+shift+p>w kitten hints --type word --program -
map ctrl+shift+p>h kitten hints --type hash --program -
map ctrl+shift+p>n kitten hints --type linenum
#map ctrl+shift+p>n kitten hints --type=linenum --linenum-action=tab nvim +{line} {path}
map ctrl+shift+p>e open_url_with_hints
map ctrl+shift+e kitten hints --type hyperlink

# Miscellaneous
#map ctrl+shift+f toggle_maximized
map ctrl+shift+u kitten unicode_input
map ctrl+shift+escape kitty_shell window
map ctrl+shift+delete clear_terminal reset active
map ctrl+alt+delete clear_terminal reset all
#map ctrl+shift+s clone-in-kitty --type=tab
#map ctrl+shift+s clone-in-kitty --title "I am a clone"
#map ctrl+shift+z scroll_to_prompt -1
#map ctrl+shift+x scroll_to_prompt 1

# broadcast to other windows in the current tab
#map ctrl+shift+alt+b launch --allow-remote-control kitty +kitten broadcast --match-tab state:focused

# Highlighting words
#map ctrl+shift+a create_marker
#map ctrl+shift+d remove_marker
#map ctrl+shift+alt+a scroll_to_mark prev
#map ctrl+shift+alt+d scroll_to_mark next


######################
# SEND KEYS EXAMPLES #
######################
# Keybinds for commands - run kitty +kitten show_key to get the key escape codes you want to emulate
#map ctrl+shift+x send_text normal fpop\r
#map ctrl+shift+p send_text normal fpdf\r
#map ctrl+shift+n send_text normal fql\r
map ctrl+shift+z send_text normal fproj\r
map ctrl+shift+w send_text normal fwork\r
map alt+, send_text normal fif\r
map alt+. send_text normal fifa\r
map ctrl+. send_text normal fcd\r
map ctrl+, send_text normal navi\r

# ------- unbound keys ------- #
#map some+key send_text normal ftrack\r
#map some+key send_text normal fgb\r
#map some+key send_text normal fgl\r
#map ctrl+; send_text normal tre '       # AVAILABLE
#map ctrl+' send_text normal trp '       # AVAILABLE


#########################
# CTRL+SHIFT + ... KEYS #
#########################
# ctrl+key - all keys taken by zsh with exceptions: , . ; ' [ ]. In emacs I have them bound the same as in my zsh so using these isn't recommended
# ctrl+shift+key - all available
# alt+key - don't use the same keys that I have unavailable in emacs
# alt+shift+key - all available


########################
# ALt+SHIFT + ... KEYS #
########################
map alt+shift+p launch sh -c "paru -Slq | fzf --multi --reverse --preview 'paru -Si {1}' | xargs -ro paru -S"
map alt+shift+e launch sh -c "emacsclient -nw && exec zsh"
map alt+shift+d launch sh -c "emacsclient -nw -e '(dired \"./\")' && exec zsh"
map alt+shift+y launch sh -c "cliphist list | fzf | cliphist decode | wl-copy"   # TODO - Upgrade TO PASTE INSTEAD OF COPYING


#########################
# CTRL+ALT + ... KEYS #
#########################
### EXAMPLES ###
## Possible types: launch my_program --type=window/tab/os-window/overlay/overla-main/background/clipboard, primary
# run in new window
#map ctrl+alt+m launch sh -c "himalaya list"

# run in an selected active window
#map ctrl+alt+w launch cava @active-kitty-window-id
# replaced by the currently selected text
#map ctrl+alt+e launch cava @selection
# run in new window with the same wd
#map ctrl+alt+r launch --cwd=current cava
# run in new window in new tab
#map ctrl+alt+t launch --type=tab cava
# run multiple commands in new window
#map ctrl+alt+y launch sh -c "ls && exec zsh"
# pass the contents of the current screen and scrollback to the started process
#map ctrl+alt+u launch --stdin-source=@screen_scrollback less


###########
# SOURCES #
###########
# if kitty conf doesn't load then try removing and adding those again
include theme.conf
include open-actions.conf
#include ssh.conf
#include diff.conf
