#+title: GNU Emacs Keybindings Cheatsheet

This documentation provides cheat sheet for my emacs keybindings configuration which is designed to minimze the need for excessive and complex key combinations and utilizing those that are often overlooked or unutilized by default thereby reducing cognitive load and improving overall efficiency and productivity. I'm obsessed with optimizing my time and automating my workflow and I spend countless hours configuring my OS. The philosophy adopted in this configuration prioritizes simplicity and ease of use:
  - All keys that I *often* use require the user to press 2 keys while holding the Control key, i.e. =C-x C-<key>= or =C-x <key>=.
  - For convenience I also have other global leader keys (that are unutilized by default) depending on which mode I'm in: =C-z=, =C-x=, =C-c=, =C-h=.
  - All other keys that I *rarely* use have its prefix key after the leader key which is =SPC=, effectively requiring the user to press 3 buttons including the =SPC= key.

The world's greatest programmer once said:
#+begin_quote
"an idiot admires complexity, a genius admires simplicity."
#+end_quote

* Table of Contents :toc:
- [[#essential-keybindings][Essential Keybindings]]
  - [[#keybindings-without-prefix-key][Keybindings without prefix key]]
  - [[#common-keybindings][Common keybindings]]
- [[#file-search][File Search]]
  - [[#open-specific-files][Open specific files]]
- [[#navigation][Navigation]]
  - [[#window-splits][Window Splits]]
  - [[#window-movement][Window Movement]]
- [[#other][Other]]
  - [[#source-code-block-tag-expansion][Source Code Block Tag Expansion]]
  - [[#help-pages][Help pages]]
  - [[#line-settings][Line settings]]
  - [[#buffer-management][Buffer Management]]
  - [[#neotree][Neotree]]
  - [[#dired][Dired]]
- [[#wip][WIP]]
  - [[#workspace-management][Workspace Management]]
  - [[#bookmark-management][Bookmark Management]]
  - [[#ibuffer-mode][Ibuffer mode]]
  - [[#perspective][Perspective]]
  - [[#registers][Registers]]
- [[#file-search-1][File Search]]
  - [[#general-file-search][General file search]]
- [[#org-mode][Org Mode]]
  - [[#org-mode-basics][Org mode basics]]
  - [[#org-roam][Org-Roam]]
  - [[#task-management][Task Management]]
  - [[#style-formatting-visual-mode][Style formatting (visual mode)]]
  - [[#tables][Tables]]
- [[#packages][Packages]]
  - [[#magit][Magit]]
  - [[#evil-snipe][Evil-Snipe]]
  - [[#treemacs][Treemacs]]
- [[#system-config-and-setup-on-wayland][System config and setup on Wayland]]
  - [[#setup-on-hyprland-wm][Setup on Hyprland WM]]
  - [[#mime-types][Mime types]]
  - [[#git-diffs][Git diffs]]
  - [[#literate-programming][Literate programming]]

* Essential Keybindings
** Keybindings without prefix key
| Keybinding | Description          |
|------------+----------------------|
| C-h/j/k/l  | Switch window focus  |
| C-=/-      | Zoom In/Out          |
| M-p/n      | Buffer Previous/Next |

** Common keybindings
| Keybinding | Description             |
|------------+-------------------------|
| SPC .      | Create or find file     |
| C-x c      | Recently opened files   |
| C-x C-s    | Save the current buffer |
| C-x C-r    | Reload emacs            |

* File Search
** Open specific files
| Keybinding | Description      |
|------------+------------------|
| C-x C-c    | Edit config file |

* Navigation
** Window Splits
| Keybinding | Description             |
|------------+-------------------------|
| C-z C-c    | Close window            |
| C-z C-n    | New window              |
| C-z C-s    | Horizontal split window |
| C-z C-v    | Vertical split window   |

** Window Movement
| Keybinding | Description       |
|------------+-------------------|
| C-z C-h    | Move window left  |
| C-z C-j    | Move window down  |
| C-z C-k    | Move window up    |
| C-z C-l    | Move window right |

* Other
** Source Code Block Tag Expansion
| Typing the below + TAB | Expands to ...                          |
|------------------------+-----------------------------------------|
| <a                     | '#+BEGIN_EXPORT ascii' … '#+END_EXPORT  |
| <c                     | '#+BEGIN_CENTER' … '#+END_CENTER'       |
| <C                     | '#+BEGIN_COMMENT' … '#+END_COMMENT'     |
| <e                     | '#+BEGIN_EXAMPLE' … '#+END_EXAMPLE'     |
| <E                     | '#+BEGIN_EXPORT' … '#+END_EXPORT'       |
| <h                     | '#+BEGIN_EXPORT html' … '#+END_EXPORT'  |
| <l                     | '#+BEGIN_EXPORT latex' … '#+END_EXPORT' |
| <q                     | '#+BEGIN_QUOTE' … '#+END_QUOTE'         |
| <s                     | '#+BEGIN_SRC' … '#+END_SRC'             |
| <v                     | '#+BEGIN_VERSE' … '#+END_VERSE'         |

** Help pages
| Keybinding | Description       |
|------------+-------------------|
| SPC h f    | Describe function |
| SPC h v    | Describe variable |

** Line settings
| Keybinding | Description                |
|------------+----------------------------|
| SPC TAB    | Comment or uncomment lines |
| SPC t l    | Toggle line numbers        |
| SPC t t    | Toggle truncate lines      |

** Buffer Management
| Keybinding | Description      |
|------------+------------------|
| SPC b b    | Switch buffer    |
| SPC b i    | Ibuffer          |
| SPC b k    | Kill this buffer |
| SPC b n    | Buffer next      |
| SPC b p    | Buffer previous  |
| SPC b r    | Reload buffer    |

** Neotree
| Keybinding  | Description                                                      |
|-------------+------------------------------------------------------------------|
| n/p         | Next/previous line                                               |
| SPC/RET/TAB | Open current iterm if it's a file. Fold/unfold if it's directory |
| U           | Go up a directory                                                |
| g           | Refresh                                                          |
| A           | Maximize/Minimize the Neotree widno                              |
| H           | Toggle display hidden files                                      |
| O           | Recursively open a directory                                     |
| C-c C-n     | Create a file or create a directory if filename ends with a '/'  |
| C-c C-d     | Delete a file or a directory                                     |
| C-c C-r     | Rename a file or a directory                                     |
| C-c C-c     | Change the root directory                                        |
| C-c C-p     | Copy a file or a directory                                       |

** Dired
| Keybinding | Description                                        |
|------------+----------------------------------------------------|
| C          | Create a new subdirectory                          |
| m          | Mark files or directories for operations           |
| u          | Unmark previously marked files or directories      |
| U          | Unmark all marked fiels or directories             |
| d          | Delete marked files or directories                 |
| R          | Rename or move files                               |
| C          | Copy marked files                                  |
| +          | Create an empty file                               |
| %          | Mark files based on a regular expression           |
| !          | Run a shell command on marked files                |
| =          | Compare files with their backups or other versions |
| z          | Compress or decompress marked files                |
| Q          | Toggle read-only mode for the current Dired buffer |

* WIP
** TODO Workspace Management
| Keybinding | Description                 |
|------------+-----------------------------|
| C-t        | New workspace               |
| SPC TAB N  | New workspace and name it   |
| SPC TAB [  | Previous workspace          |
| SPC TAB ]  | Next workspace              |
| SPC TAB d  | Remove workspace            |
| SPC TAB R  | Restore last session        |
| M-1/2/3/4  | Switch to workspace 1/2/3/4 |

** Bookmark Management
| Keybinding | Description                            |
|------------+----------------------------------------|
| SPC b L    | List bookmarks                         |
| SPC b m    | Set bookmark                           |
| SPC b M    | Delete bookmark                        |
| SPC b w    | Save current bookmark to bookmark file |

** Ibuffer mode
| Keybinding | Description                            |
|------------+----------------------------------------|
| m          | Mark the buffer                        |
| u          | Unmark the buffer                      |
| x          | Kill the marked buffers                |
| f c        | Ibuffer filter by content              |
| f d        | Ibuffer filter by directory            |
| f f        | Ibuffer filter by filename (full path) |
| f m        | Ibuffer filter by mode                 |
| f n        | Ibuffer filter by name                 |
| f x        | Disable ibuffer filter                 |
| g h        | Hide marked buffers                    |
| g H        | Restore hidden buffers                 |

** Perspective
| Keybinding | Description                         |
|------------+-------------------------------------|
| SPC DEL    | Switch to perspective NAME          |
| SPC ,      | Switch to buffer in perspective     |
| SPC ]      | Switch to next perspective          |
| SPC [      | Switch to previous perspective      |
| SPC +      | Add a buffer to current perspective |
| SPC -      | Remove perspective by name          |
| SPC 0-9    | Switch to workspace n               |

** Registers
| Keybinding | Description                      |
|------------+----------------------------------|
| SPC r c    | Copy to register                 |
| SPC r f    | Frameset to register             |
| SPC r i    | Insert contents of register      |
| SPC r j    | Jump to register                 |
| SPC r l    | List registers                   |
| SPC r n    | Number to register               |
| SPC r r    | Interactively choose a register  |
| SPC r v    | View a register                  |
| SPC r w    | Window configuration to register |
| SPC r +    | Increment register               |
| SPC r SPC  | Point to register                |

* TODO File Search
** General file search
| Keybinding | Description                         |
|------------+-------------------------------------|
| SPC p r    | Recently visited files in a project |
| SPC p p    | Open a project                      |
| SPC SPC    | Open a file in a project            |


* TODO Org Mode
** Org mode basics
| Keybinding | Description                                        |
|------------+----------------------------------------------------|
| SPC n      | Prefix for org keybinding                          |
| SPC m h    | toggle heading                                     |
| SPC m i    | toggle item                                        |
| C-Ret      | Create a headline of the same type                 |
| C-S-Ret    | Create a headline of the same type above           |
| M-Ret      | Create a headline of the same type (from anywhere) |
| C-M-Ret    | Create another level headline (from anywhere)      |
| TAB/S-TAB  | Toggle folding/cycle through folded stages         |
| M-h/j/k/l  | Promotes/demotes/up/down header                    |
| SPC b o    | Create new empty Org buffer                        |
| g h/j/k/l  | Backward/forward/up/down heading                   |

** TODO Org-Roam
| Keybinding | Description                        |
|------------+------------------------------------|
| SPC n r f  | Create/find new node               |
| SPC n r i  | Insert link to other node          |
| SPC n r r  | Toggle roam buffers                |
| SPC n r c  | Completion of node-insert at point |
| SPC n r g  | Show graph of all nodes            |
| SPC n r n  | Capture to node                    |

** TODO Task Management

*** TODO Lists

*** TODO Checkboxes

*** TODO Links and hyperlinks
- You can add =::= to specify a heading or a line number
- You can paste http links as well

| Keybinding | Description               |
|------------+---------------------------|
| SPC m l    | Add a link to an org page |
| SPC m l f  | Insert file link          |

** Style formatting (visual mode)
| Keybinding | Description |
|------------+-------------|
| m          | Bold        |
| /          | Italic      |
| .          | Green color |

** Tables
- To start a table just start typing: =| table | name | description=

| Keybinding          | Description                                   |
|---------------------+-----------------------------------------------|
| TAB/S-Tab           | Forward/backward                              |
| SPC m b -           | Make org table headline                       |
| S-Ret               | Duplicate a field in the call below           |
| C-Ret (normal mode) | Create new table below                        |
| Ret (normal mode)   | Clear the field and enter insert mode         |
| M-h/j/k/l           | The same essential keybindings for navigation |
| M-S-j/k             | Insert a new row above/delete current row     |
| o                   | Insert new roam and move to the beginning     |

* TODO Packages
** TODO Magit
** TODO Evil-Snipe
*** TODO Inline navigation

*** TODO Long distance navigation
** TODO Treemacs
| Keybinding | Description       |
|------------+-------------------|
| SPC o p    | Toggle on and off |

* TODO System config and setup on Wayland
** Setup on Hyprland WM
1. Run my installer script
   #+begin_src bash
    bash <(curl -s https://raw.githubusercontent.com/Twilight4/arch-setup/main/tool-scripts/emacs.sh)
    #+end_src
2. Add emacs daemon mode to =autostart.conf=
   #+begin_src bash
    exec-once=emacs --daemon
   #+end_src
3. Add emacs client to autostart in =autolaunch= script
   #+begin_src
     hyprctl keyword windowrule "workspace 4 silent,emacs" && sleep 3 && hyprctl dispatch exec "emacsclient -c -a emacs"   # sleep 3 waits for emacs --daemon from autstart.conf to start
     hyprctl keyword windowrule "unset,emacs"
   #+end_src
4. Set vars in =.zshenv=
   #+begin_src bash
    EDITOR="emacsclient -c -a emacs"
    ALTERNATE_EDITOR=""
   #+end_src
5. Add a keybinding for launching emacs client in =keybinds.conf=
   #+begin_src bash
    bind = SUPER, E, exec, pgrep 'emacs' && hyprctl dispatch focuswindow '^emacs$' || hyprctl dispatch exec 'emacsclient -c -a emacs'
   #+end_src

** Mime types
Org mode isn't recognised as it's own mime type by default, but that can easily be changed with the following file. For system-wide changes try ~/usr/share/mime/packages/org.xml~.

#+begin_src xml
<mime-info xmlns='http://www.freedesktop.org/standards/shared-mime-info'>
  <mime-type type="text/org">
    <comment>Emacs Org-mode File</comment>
    <glob pattern="*.org"/>
    <alias type="text/org"/>
  </mime-type>
</mime-info>
#+end_src
What's nice is that Papirus [[https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/commit/a10fb7f2423d5e30b9c4477416ccdc93c4f3849d][now]] has an icon for =text/org=. One simply needs to refresh their mime database
#+begin_src shell
update-mime-database ~/config/.local/share/mime
#+end_src
Then set Emacs as the default editor
#+begin_src shell
xdg-mime default emacs.desktop text/org
#+end_src

** Git diffs
Protesilaos wrote a [[https://protesilaos.com/codelog/2021-01-26-git-diff-hunk-elisp-org/][very helpful article]] in which he explains how to change the git diff chunk heading to something more useful than just the immediate line above the hunk --- like the parent heading.

This can be achieved by first adding a new diff mode to git in =~/.config/git/attributes=
#+begin_src fundamental
,*.org   diff=org
#+end_src

Then adding a regex for it to =~/.config/git/config=
#+begin_src gitconfig
[diff "org"]
  xfuncname = "^(\\*+ +.*)$"
#+end_src
** Literate programming
1. =<s *TAB*=
2. define which file should be it tangled
   in the beginning
   - =+property header-args :tangle config.el=
   or with the code block
   - =#+begin_src xml :tangle ~/.local/share/mime/packages/org.xml :mkdirp yes :comments no=
3. Go to the beginning of the line and press: =C-c C-c=
4. If tangled file hasn't been created use: =org-babel-tangle=
