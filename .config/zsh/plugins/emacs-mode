#!/usr/bin/env zsh

# Always be in insert mode
bindkey -v

# Emacs-like bindings
# Movement
bindkey '^B' backward-char
bindkey '^F' forward-char
bindkey '^A' beginning-of-line
bindkey '^E' end-of-line
bindkey '^[b' backward-word
bindkey '^[f' forward-word
# Killing and yanking
bindkey '^U' backward-kill-line
bindkey '^O' kill-line
bindkey '^D' delete-char-or-list    # (del) upgrade to cut to clipbaord when in selection mode
bindkey '^[d' kill-word
bindkey '^[w' backward-kill-word
bindkey '^?' backward-delete-char   # (backspace) upgrade to cut to clipbaord when in selection mode
bindkey '^H' backward-kill-word     # (C-backspace)
bindkey '^W' backward-delete-char   # (todo - backspace) upgrade to cut to clipbaord when in selection mode

#bindkey '^R' history-incremental-search-backward  # have bound fzf
#bindkey '^S' history-incremental-search-forward   # not sure of implementation yet
#bindkey '^Y' yank    # ugprade to paste from clipboard in terminal config

# Full keyboard keys
bindkey 'Home' beginning-of-line
bindkey 'End' end-of-line
bindkey '^[u' up-case-word
bindkey '^[l' down-case-word
bindkey '^[[1~' beginning-of-line
bindkey '^[[4~' end-of-line
bindkey '^[[1;5C' forward-word
bindkey '^[[1;5D' backward-word
bindkey '^[[A' up-line-or-history
bindkey '^[[B' down-line-or-history
bindkey '^[[5~' beginning-of-buffer-or-history
bindkey '^[[6~' end-of-buffer-or-history
bindkey '^[[3~' delete-char
bindkey '^[[Z' reverse-menu-complete
# EXPERIMENTAL
bindkey -M vicmd '^[.' insert-last-word  # M-.
bindkey -M vicmd '^[g' get-line          # M-g
bindkey -M vicmd '^Q' push-line          # C-q
bindkey '^X^E' edit-command-line         # Open in emacs
bindkey '^V' edit-command-line           # Open in emacs
bindkey -M visual '^[' '^[v'             # selection-mode
bindkey -M visual '^[x' '^[x'            # selection-mode

# Visual mode on Ctrl+SPC
function visual-mode {
    zle set-mark-command
    zle vi-match-bracket
}
zle -N visual-mode
bindkey '^ ' visual-mode

autoload -Uz surround
zle -N delete-surround surround
zle -N change-surround surround
zle -N add-surround surround

# Escape shortcut
bindkey '^[D' vi-cmd-mode
function vim-mode-accept-or-eof() {
    if [[ $#BUFFER = 0 ]]; then
        exit
    else
        zle accept-line
    fi
}
zle -N vim-mode-accept-or-eof
bindkey '^Q' vim-mode-accept-or-eof

# Identify editing mode
VIM_MODE_KEYMAP=viins

function vim-mode-set-keymap () {
    # This function is intentionally left empty
}

# Restore shell option 'aliases'
set -o aliases
